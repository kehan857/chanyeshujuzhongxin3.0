# 聚合聊天界面 (Aggregated Chat) 设计规格

## 页面概述
聚合聊天界面是销售人员的核心工作台，提供统一的多账号聊天管理和AI接管控制功能。

## 布局设计 - 三栏式布局

### 左栏 - 会话列表 (320px宽度)
```
┌────────────────────────────────┐
│  🔍 搜索框 (昵称/备注/群名)      │
├────────────────────────────────┤
│  筛选器: [全部▼] [未读] [已托管] │
├────────────────────────────────┤
│  👤 张三 (VIP客户)             │
│     💬 好的，我了解了...        │
│     ⏰ 14:30  🔴 2            │
├────────────────────────────────┤
│  👥 产品讨论群 (25人)          │
│     📎 [文件] 产品介绍.pdf      │
│     ⏰ 13:45                  │
├────────────────────────────────┤
│  👤 李四 (潜在客户)            │
│     💬 价格是多少？            │
│     ⏰ 12:20  🔴 1            │
└────────────────────────────────┘
```

### 中栏 - 聊天窗口 (flex-1)
```
┌────────────────────────────────────────────────────────┐
│  👤 张三 (VIP客户)                    🤖 AI接管中 ●   │
├────────────────────────────────────────────────────────┤
│                                                       │
│  👤 张三: 你们这个产品的价格是多少？                    │
│        📅 14:25                                      │
│                                                       │
│  🤖 AI助手: 感谢您的咨询！我们的产品有多个版本...        │
│        📅 14:26                                      │
│                                                       │
│  👤 张三: 有没有优惠活动？                              │
│        📅 14:30                                      │
│                                                       │
│  ⚠️ [AI检测到价格敏感话题，建议人工介入]                 │
│                                                       │
├────────────────────────────────────────────────────────┤
│  💬 输入框...              📎 🖼️ 😊 📚物料库   发送    │
└────────────────────────────────────────────────────────┘
```

### 右栏 - 上下文信息面板 (280px宽度)
```
┌────────────────────────────────┐
│  🔄 AI接管状态控制               │
│  ┌─────────────────────────────┐ │
│  │ ● AI接管中     [切换人工] │ │
│  └─────────────────────────────┘ │
├────────────────────────────────┤
│  👤 客户信息                    │
│  • 微信昵称: 张三               │
│  • 微信号: zhangsan_001        │
│  • 备注: VIP客户               │
│  • 所属分组: 高意向客户         │
├────────────────────────────────┤
│  🏷️ 标签管理                   │
│  [VIP客户] [已付费] [+添加]     │
├────────────────────────────────┤
│  📋 历史任务记录                │
│  • 新客户破冰SOP ✅            │
│  • 产品介绍推送 ⏳             │
│  • 节日问候 📅 明天            │
├────────────────────────────────┤
│  🔧 快捷操作                   │
│  [修改备注] [加入分组]          │
│  [创建任务] [查看详情]          │
└────────────────────────────────┘
```

## 核心功能设计

### AI接管状态控制
```typescript
interface AIControlState {
  isAIEnabled: boolean;      // AI是否启用
  mode: 'auto' | 'manual';   // 自动/手动模式
  interventionAlert: boolean; // 是否有人工介入提醒
}
```

### 人工介入通知系统
- **桌面通知**: 浏览器原生通知API
- **声音提示**: 可配置的提示音
- **视觉高亮**: 
  - 左侧会话列表红色边框高亮
  - 自动置顶需要介入的会话
  - 聊天窗口中显示介入提醒横幅

### 消息类型支持
- **文本消息**: 普通文字内容
- **图片消息**: 缩略图预览，点击放大
- **文件消息**: 文件名、大小、下载按钮
- **小程序卡片**: 标题、描述、预览图
- **名片消息**: 联系人信息展示

## 交互细节

### 左栏会话列表
- **搜索功能**: 实时搜索，支持拼音首字母
- **筛选器**: 多条件组合筛选
- **未读消息**: 红色数字徽章显示
- **拖拽排序**: 支持手动调整会话顺序
- **右键菜单**: 标记已读、删除会话、置顶等

### 中栏聊天窗口  
- **消息加载**: 向上滚动自动加载历史消息
- **消息状态**: 发送中、已发送、已读状态指示
- **快速回复**: 常用话术快捷按钮
- **@功能**: 群聊中@特定成员
- **消息撤回**: 2分钟内可撤回已发送消息

### 右栏信息面板
- **动态更新**: 根据选中会话自动切换显示内容
- **标签编辑**: 点击即可编辑标签
- **任务跳转**: 点击任务可跳转到任务详情页

## 响应式适配

### 平板端 (768px - 1024px)
- 隐藏右栏，通过抽屉方式显示
- 左栏宽度调整为280px

### 移动端 (< 768px)  
- 采用全屏单栏切换模式
- 会话列表 ↔ 聊天窗口 ↔ 信息面板

## 性能优化
- **虚拟滚动**: 长会话列表使用虚拟滚动
- **消息分页**: 聊天记录分页加载
- **图片懒加载**: 聊天中的图片延迟加载
- **WebSocket**: 实时消息推送

